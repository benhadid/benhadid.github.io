<!DOCTYPE html>
<html>

  <head>
  

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title> Travaux Pratiques #1 - Ligne de commande et débogage de programmes - Architecture des ordinateurs / Automne 2020 </title>
  <meta name="description" content="Objectifs  L’étudiant sera initié aux commandes de base du shell Un*x.  L’étudiant sera capable de compiler et d’exécuter un programme C sur les ordinateurs ...">
  
  <link rel="stylesheet" href="/l2ado/_css/main.css">
  <link rel="canonical" href="http://benhadid.github.io//l2ado/labs/01_lab">
  <link rel="alternate" type="application/rss+xml" title="Architecture des ordinateurs / Automne 2020 - " href="http://benhadid.github.io//l2ado/feed.xml" />
<link rel='stylesheet' id='open-sans-css'  href='//fonts.googleapis.com/css?family=Open+Sans%3A300italic%2C400italic%2C600italic%2C300%2C400%2C600&#038;subset=latin%2Clatin-ext&#038;ver=4.2.4' type='text/css' media='all' />
<link href='https://fonts.googleapis.com/css?family=Titillium+Web:600italic,600,400,400italic' rel='stylesheet' type='text/css'>




<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">

<!-- MathJax -->
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
</head>


  <body>

    <header class="site-header">

  <div class="wrapper" style="z-index: 100;">
      <table><tr>
          <td><img width="75" src="/l2ado/_images/logo.png" valign="middle"></td>
          <td style="padding-left:10px;"><a class="schoolname" style="font-size: 15px;" class="site-title" href=""></a>
          <br/>
          <span style="margin-top: -2px;margin-bottom: -10px;" class="site-title"><a href="/l2ado/" title="Architecture des ordinateurs / Automne 2020 - "><b>Architecture des ordinateurs</a></b></span>
          <br/>
          <span class="coursesemeter" style="font-size: 12px;font-weight: bold;margin-top: 10px;display: block;">Automne 2020</span>
          </td>
        </tr></table>

    <nav class="site-nav">

      <a href="#" class="menu-icon menu.open">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>  

    <div class="trigger"><h1>Main Navigation</h1>

 <ul class="menu">
    
    <li>
        <a class="page-link" href="/l2ado/">
            <i class="fa fa-home fa-lg"></i> Accueil
        </a>
    </li>
    
    <li>
        <a class="page-link" href="/l2ado/schedule/">
            <i class="fas fa-calendar-alt"></i> Programme
        </a>
    </li>
    
    <li>
        <a class="page-link" href="/l2ado/lectures/">
            <i class="fas fa-book-reader"></i> Cours
        </a>
    </li>
    
    <li>
        <a class="page-link" href="/l2ado/labs/">
            <i class="fas fa-laptop-code"></i> Pratiques
        </a>
    </li>
    
    <li>
        <a class="page-link" href="/l2ado/assignments/">
            <i class="fas fa-user-graduate"></i> Devoirs
        </a>
    </li>
    
    <li>
        <a class="page-link" href="/l2ado/project/">
            <i class="fas fa-user-graduate"></i> Projet
        </a>
    </li>
    
    <li>
        <a class="page-link" href="/l2ado/materials/">
            <i class="fas fa-book"></i> Support
        </a>
    </li>
    
</ul>

     </div>  
    </nav>

  </div>

  <div class="header-texture" style="height:100%; z-index: 0; position: absolute; top:0; right: 0; left: 0; 
  background-image: url('/l2ado/_images/pattern.png');" />

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Travaux Pratiques #1 - Ligne de commande et débogage de programmes</h1>
    <p class="post-meta">Publié le Thursday 19/09/2019</p>
  </header>

  <div>
    
    <span style="font-weight: bold">Date prévue : 
      <!-- 26/09/2019 -->

      
      Jeudi
      26
      
      Septembre
      2019
  

    </span>
    

    
    <p style="font-weight: bold">Télécharger

      

      
      [<a href="/l2ado/static_files/labs/lab_01.zip">démarrage</a>]
      

      

    </p>
    

  </div>

  <br />
  <article class="post-content">
    <h1 id="objectifs">Objectifs</h1>
<ul>
  <li>L’étudiant sera initié aux commandes de base du shell Un*x.</li>
  <li>L’étudiant sera capable de compiler et d’exécuter un programme C sur les ordinateurs des laboratoires MI et d’examiner différents types de flux de contrôle en C.</li>
  <li>L’étudiant sera initié au débogueur C et acquerra une expérience pratique de l’utilisation de gdb pour déboguer des programmes C.</li>
</ul>

<h1 id="installation-et-configuration">Installation et configuration</h1>

<p>Pour ce devoir et les devoirs futurs de ce cours, il est suggéré d’effectuer l’installation/configuration suivante sur votre ordinateur personnel :</p>

<ol>
  <li>Commencez par télécharger VirtualBox à partir de ce <a href="https://www.virtualbox.org/wiki/Downloads">lien</a>. Installez la version 6.1.x</li>
  <li>Toujours depuis la même page de VirtualBox, téléchargez et installez le pack d’extension (Extension Pack) correspondant à la version de VirtualBox que vous venez d’installer sur votre machine.</li>
  <li>Maintenant, téléchargez et installez la machine virtuelle (VM) “cvlab.ova” (3.2 Go) à partir de ce <a href="https://1drv.ms/u/s!Agf0g-qZKM8_2jSH7S2sPdsyIWe-?e=1p2H7D">lien</a>. Pour ajouter la VM à VirtualBox, suivez les instructions données <a href="https://docs.oracle.com/cd/E26217_01/E26796/html/qs-import-vm.html">ici</a>.</li>
  <li>C’est fini ! Vous disposez maintenant d’une machine virtuelle avec une configuration semblable aux machines MI (Labo 4).</li>
  <li>Si votre ordinateur possède 4 Go ou plus de de Mémoire RAM, il est préférable dans ce cas de reconfigurer la VM pour lui attribuer <a href="https://docs.bitnami.com/virtual-machine/faq/administration/increase-memory/">plus de mémoire</a>.</li>
  <li>Une fois la VM lancée, le système est configuré pour utiliser par défaut un clavier américain (comme dans les salles machines). Vous pouvez permuter vers un clavier français en cliquant avec la souris sur le drapeau americain en haut à droite de l’écran.</li>
</ol>

<p><strong>Remarque</strong> : Vous êtes libres d’installer/configurer vos propres PCs de la manière qui vous convient. Cependant, pour réaliser les devoirs de ce cours sans trop de difficultés et afin d’éviter les problèmes/excuses/frustrations du genre « pourquoi ça fonctionne sur mon PC mais pas sur le PC du labo ? », vous êtes vivement encouragés à installer la VM fournie en suivant les instructions données ci-dessus. Cela devrait rendre votre vie beaucoup plus facile.</p>

<h1 id="exercice-1--unx-shell">Exercice 1 : (Un*x shell)</h1>

<p>Afin d’acquérir un minimum d’expérience avec la ligne de commande (Command Line Interface - CLI) sous UN*X, nous introduisons ici quelques commandes courantes qui peuvent vous être utiles pendant ce cours. Pour une introduction aux commandes UN*X de base, consultez ce <a href="https://tutorials.ubuntu.com/tutorial/command-line-for-beginners">didacticiel</a>.</p>

<p>Les exemples de commandes seront affichés comme suit :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"Hello world"</span>
</code></pre></div></div>

<p>Taper l’instruction ci-dessus (sans le $) dans un terminal exécutera la commande. Ici, l’instruction affiche simplement le message “Hello world” (sans les guillemets).</p>

<p>Les drapeaux (<em>anglais</em>: flags) sont utilisés pour spécifier éventuellement des options pour la commande à exécuter ou modifier son comportement. Ils commencent généralement par un ou deux tirets et peuvent éventuellement prendre un argument.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gcc <span class="nt">--help</span>
<span class="nv">$ </span><span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"Hello</span><span class="se">\n</span><span class="s2">world"</span>
</code></pre></div></div>

<h2 id="raccourcis-cli">Raccourcis CLI</h2>

<p>Lors de la saisie de commandes ou de chemins de fichiers :</p>

<ul>
  <li>la touche <code class="language-plaintext highlighter-rouge">&lt;tab&gt;</code> complétera automatiquement le terme actuel</li>
  <li>les touches <code class="language-plaintext highlighter-rouge">&lt;flèche haut&gt;</code> et <code class="language-plaintext highlighter-rouge">&lt;flèche bas&gt;</code> vous permettront de réutiliser les commandes que vous avez tapées précédemment sans les saisir à nouveau.</li>
  <li>la combinaison <code class="language-plaintext highlighter-rouge">&lt;ctrl&gt; + a</code> déplacera le curseur au début de la ligne courante (utile pour corriger les erreurs)</li>
  <li>la combinaison <code class="language-plaintext highlighter-rouge">&lt;ctrl&gt; + e</code> déplacera le curseur à la fin de la ligne courante (également utile pour corriger les erreurs)</li>
  <li>la combinaison <code class="language-plaintext highlighter-rouge">&lt;ctrl&gt; + r</code> vous permettra d’effectuer une recherche dans la commande récemment utilisée</li>
</ul>

<h2 id="manipulation-de-fichiers">Manipulation de Fichiers</h2>

<p>La commande <code class="language-plaintext highlighter-rouge">touch</code> permet de créer un fichier vide avec le nom de fichier fourni en argument.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">touch </span>example.txt
</code></pre></div></div>

<p>Cela créera un fichier nommé « exemple.txt » sans rien à l’intérieur. Si vous souhaitez créer un fichier non vide (i.e. avec du contenu), vous pouvez utiliser la commande</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"Votre contenu entre les guillements"</span> <span class="o">&gt;</span> example.txt
</code></pre></div></div>

<p>Cela créera un fichier avec le nom « exemple.txt » dans le répertoire actuel. Si le fichier existe déjà alors il sera écrasé. Le (nouveau) fichier contiendra “Votre contenu entre les guillemets” mais sans les guillemets.</p>

<p>Le symbole <code class="language-plaintext highlighter-rouge">&gt;</code> est suivi d’un argument pour rediriger vers un fichier (i.e. example.txt) les données qui sont normalement envoyées vers <code class="language-plaintext highlighter-rouge">stdout</code> (i.e. l’écran). Ici, nous redirigeons la sortie de <code class="language-plaintext highlighter-rouge">echo</code> vers un fichier nommé<code class="language-plaintext highlighter-rouge"> example.txt</code>.</p>

<p>Vous pouvez également utiliser la commande <code class="language-plaintext highlighter-rouge">echo</code> sans redirection, auquel cas elle affichera la chaîne de caractères sur le terminal (sans créer de fichier dans le processus).</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">echo</span> <span class="s2">"Hello world"</span>
</code></pre></div></div>

<p>Pour visualiser le contenu d’un fichier, vous pouvez utliser les commandes <code class="language-plaintext highlighter-rouge">cat</code> ou<code class="language-plaintext highlighter-rouge"> less</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>example.txt
<span class="nv">$ </span>less example.txt
</code></pre></div></div>

<p>La commande <code class="language-plaintext highlighter-rouge">cat</code> affiche le contenu de <code class="language-plaintext highlighter-rouge">example.txt</code> sur votre terminal. <code class="language-plaintext highlighter-rouge">less</code> lance un éditeur basique. Vous pouvez donner comme argument à <code class="language-plaintext highlighter-rouge">cat</code> ou <code class="language-plaintext highlighter-rouge">less</code> un chemin relatif ou absolu pour afficher le contenu des fichiers non locaux.</p>

<h2 id="man---pages-de-manuel"><code class="language-plaintext highlighter-rouge">man</code> - Pages de manuel</h2>

<p>Les pages de manuel (<em>anglais</em> : « man pages ») sont d’excellentes ressources UN*X qui sont souvent sous-utilisées; bien qu’elles ne soient pas aussi polyvalents que Google, elles contiennent de la documentation sur les composants UN*X comme les manuels d’utilisation des programmes, des normes et conventions linguistiques, etc. Elles fonctionnent également hors ligne et peuvent donc être utiles si vous êtes coincé sans internet parce que le cable sousmarin a été rupturé une n-ième fois (ou pendant la période du bac !).</p>

<p>Bien que votre moteur de recherche préféré ait probablement les réponses que vous recherchez, nous aimerions dans ce cours que vous vous familiarisiez avec l’utilisation de la commande « <code class="language-plaintext highlighter-rouge">man</code> », en particulier pour les questions relatives au langage C et au systèmes d’exploitation UN*X.</p>

<p>Pour afficher la page de manuel pour une commande spécifique (ici la commande <code class="language-plaintext highlighter-rouge">echo</code> est donnée en exemple), vous pouvez exécuter l’instruction :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>man <span class="nb">echo</span> | less
</code></pre></div></div>

<p>La page de manuel d’une commande contient généralement des informations sur celle-ci, ce que font certains drapeaux lorsque vous invoquez la commande avec eux et où aller pour avoir plus d’informations.</p>

<p>Dans l’exemple ci-dessus, nous avons redirigé, grâce au symbole « <code class="language-plaintext highlighter-rouge">|</code> », le contenu du manuel d’utilisation de la commande <code class="language-plaintext highlighter-rouge">echo</code> vers le programme <code class="language-plaintext highlighter-rouge">less</code>. Cela nous permet de dérouler la page de manuel avec les touches fléchées ou la barre d’espace. Appuyez sur la touche <code class="language-plaintext highlighter-rouge">q</code> pour quitter la page de manuel et revenir à l’invite de votre terminal.</p>

<p>Si vous souhaitez rechercher dans les pages de manuel une commande relative à un mot-clé spécifique :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>man <span class="nt">-k</span> mot_clé_specifique | less
</code></pre></div></div>

<p>Cette commande recherchera dans les pages de manuel toutes les commandes avec le mot-clé <code class="language-plaintext highlighter-rouge">mot_clé_specifique</code>.</p>

<h2 id="vim-basics">Vim Basics</h2>

<p><code class="language-plaintext highlighter-rouge">vim</code> est un editeur de texte inclus dans de nombreuses distributions UN*X.</p>

<p><strong>Remarque</strong> : Nous utiliserons Vim dans la plupart des exemples et documentations fournis, mais nous n’avons aucune exigence stricte sur l’éditeur de texte que vous utiliserez; vous pouvez choisir l’éditeur de texte qui vous convient ! Toutefois, nous aimerions rappeler que, en tant que futur informaticien, vous devez savoir utiliser au moins un éditeur de texte en ligne de commande. Si vous n’aimez pas Vim, vous pouvez essayer <code class="language-plaintext highlighter-rouge">nano</code> ou <code class="language-plaintext highlighter-rouge">emacs</code>!</p>

<p>Pour ouvrir un fichier à partir de votre répertoire actuel, donnez le nom du fichier à Vim :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim filename
</code></pre></div></div>

<p>Pour ouvrir un fichier à partir d’un autre répertoire, utilisez un chemin relatif ou absolu :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vim ../other_folder/filename
</code></pre></div></div>

<h3 id="quelques-commandes-utiles-pour-vim-">Quelques commandes utiles pour Vim :</h3>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Commande</th>
      <th style="text-align: left">Signification</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">&lt;esc&gt;:q</code></td>
      <td style="text-align: left">Ferme (quitte) Vim sans enregistrer</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">&lt;esc&gt;:wq</code></td>
      <td style="text-align: left">quitte Vim après enregistrement des modifications</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">&lt;esc&gt;:w</code></td>
      <td style="text-align: left">Enregistre le fichier</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">&lt;esc&gt;:q!</code></td>
      <td style="text-align: left">Forcer à quitter Vim (lorsque vous avez effectué des modifications mais vous ne souhaitez pas les garder)</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">&lt;esc&gt;i</code></td>
      <td style="text-align: left">mode Insertion, vous permet d’insérer des caractères dans le fichier</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">&lt;esc&gt;/cats</code></td>
      <td style="text-align: left">Recherche dans le fichier la première occurrence de la chaîne de caractères « cats ». Appuyez sur <code class="language-plaintext highlighter-rouge">n</code> pour aller à l’occurrence suivante ou <code class="language-plaintext highlighter-rouge">N</code> pour retourner à la précédente</td>
    </tr>
    <tr>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">&lt;esc&gt;:setnu</code></td>
      <td style="text-align: left">Affiche les numéros de ligne dans votre fichier</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<p><strong>Remarque</strong> : Ces commandes sont précédées de <code class="language-plaintext highlighter-rouge">&lt;esc&gt;</code> pour indiquer que vous devez appuyer sur la touche d’échappement de votre clavier pour quitter le mode actuel. Par exemple, si vous voulez enregistrer votre fichier après modification, vous devez appuyer sur la touche d’échappement pour sortir du mode « insertion », puis taper « <code class="language-plaintext highlighter-rouge">:w</code> » pour sauvegarder le fichier.</p>

<h1 id="exercise-2--gdb">Exercise 2 : (gdb)</h1>

<p>Un <strong>débogueur</strong>, comme son nom l’indique, est un programme spécialement conçu pour vous aider à trouver des bogues, ou des erreurs logiques et des fautes dans votre code (remarque : si vous voulez savoir pourquoi les erreurs sont appelées bogues, regardez <a href="https://www.quora.com/Why-are-errors-in-software-codes-called-bugs">ici</a>. Différents débogueurs ont des fonctionnalités différentes, mais ils permettent tous d’effectuer les opérations suivantes :</p>

<ol>
  <li>
    <p>Définir un point d’arrêt dans le programme. Un point d’arrêt est une ligne spécifique dans votre code où vous souhaitez arrêter l’exécution du programme afin que vous puissiez examiner ce qui se passe dans cette région du code.</p>
  </li>
  <li>
    <p>Executer le programme ligne par ligne. Un code s’exécute toujours ligne par ligne, mais cela arrive trop rapidement pour que nous puissions déterminer quelles lignes ou parties du code causent des erreurs. Être capable d’examiner l’execution de votre code ligne par ligne vous permet de déterminer exactement ce qui cause un bogue dans votre programme.</p>
  </li>
</ol>

<p>Pour cet exercice, le <a href="/l2ado/static_files/docs/gdb5-refcard.pdf">document de référence GDB</a> vous sera très utile. GDB signifie « <strong>G</strong>NU <strong>D</strong>e-<strong>B</strong>ugger ». D’abord, téléchargez le fichier de démarrage (voir plus haut dans ce document) et décompressez son contenu (avec la commande <code class="language-plaintext highlighter-rouge">unzip</code>) dans le répertoire de votre choix. Compilez ensuite le fichier <code class="language-plaintext highlighter-rouge">hello.c</code> avec le drapeau <code class="language-plaintext highlighter-rouge">-g</code> (indiquez le chemin complet du fichier <code class="language-plaintext highlighter-rouge">hello.c</code> si différent du répertoire actuel ) :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gcc <span class="nt">-g</span> <span class="nt">-o</span> hello hello.c
</code></pre></div></div>

<p>Cela instruit le compilateur <code class="language-plaintext highlighter-rouge">gcc</code> à stocker des informations supplémentaires dans le programme exécutable pour que l’outil <code class="language-plaintext highlighter-rouge">gdb</code>/<code class="language-plaintext highlighter-rouge">cgdb</code> puisse interprêter correctement votre programme compilé. Maintenant, lancez le débogueur <code class="language-plaintext highlighter-rouge">cgdb</code> :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>cgdb hello
</code></pre></div></div>

<p>L’instruction ci-dessus permet de lancer le programme <code class="language-plaintext highlighter-rouge">cgdb</code> sur le fichier exécutable<code class="language-plaintext highlighter-rouge"> hello</code> généré par <code class="language-plaintext highlighter-rouge">gcc</code>. N’essayez pas d’exécuter <code class="language-plaintext highlighter-rouge">cgdb</code> sur le code source <code class="language-plaintext highlighter-rouge">hello.c</code>, il ne saura pas quoi en faire ! Si <code class="language-plaintext highlighter-rouge">cgdb</code> ne fonctionne pas pour vous, essayez avec <code class="language-plaintext highlighter-rouge">gdb</code> (démarrez <code class="language-plaintext highlighter-rouge">gdb</code> avec<code class="language-plaintext highlighter-rouge"> gdb hello</code>). Le débogueur <code class="language-plaintext highlighter-rouge">cgdb</code> est installé uniquement sur les machines des laboratoires et la machine virtuelle fournie dans la rubrique <a href="/l2ado/materials">Ressources</a> de ce site.</p>

<p><strong>Remarque</strong> : Si vous n’utilisez pas la VM fournie, vous pouvez installer et exécuter <code class="language-plaintext highlighter-rouge">gdb</code>/<code class="language-plaintext highlighter-rouge">cgdb</code> sur votre ordinateur local, mais sachez qu’il ne peut pas être installé sur des machines macOS (mises à jour). Si cela s’applique à vous, vous pouvez utiliser <code class="language-plaintext highlighter-rouge">lldb</code> qui est un autre excellent débogueur. Les commandes diffèrent légèrement de <code class="language-plaintext highlighter-rouge">gdb</code>, mais il existe d’excellents guides (<a href="Https://lldb.llvm.org/lldb-gdb.html">comme celui-ci !</a>) pour vous aider à démarrer. Pour ce TP, cependant, utilisez les machines des laboratoires (ou la VM) et <code class="language-plaintext highlighter-rouge">cgdb</code>.</p>

<h2 id="tâches-à-réaliser-">Tâches à réaliser :</h2>

<p>Parcourez le programme en procédant comme suit :</p>

<ol>
  <li>définissez un point d’arrêt sur la fonction <code class="language-plaintext highlighter-rouge">main</code></li>
  <li>utilisez la commande <code class="language-plaintext highlighter-rouge">run</code> de <code class="language-plaintext highlighter-rouge">gdb</code></li>
  <li>utilisez la commande exécution pas-à-pas de <code class="language-plaintext highlighter-rouge">gdb</code></li>
</ol>

<p>Tapez help depuis <code class="language-plaintext highlighter-rouge">gdb</code> pour connaître les commandes permettant d’effectuer ces opérations ou utilisez le document de référence fourni.</p>

<p><strong>Si vous voyez un message d’erreur comme « printf.c: No such file or directory »</strong>, vous êtes probablement entré dans une fonction <code class="language-plaintext highlighter-rouge">printf</code> ! Si vous continuez l’exécution pas-à-pas, vous aurez l’impression d’aller nulle part ! CGDB se plaint parce que vous n’avez pas le fichier source où <code class="language-plaintext highlighter-rouge">printf</code> est défini. Pour sortir de cette impasse, utilisez la commande <code class="language-plaintext highlighter-rouge">finish</code> pour exécuter le programme jusqu’au retour de la fonction non définie (dans ce cas, jusqu’à ce que <code class="language-plaintext highlighter-rouge">printf</code> soit terminée). Pour éviter ce genre de mésaventure la PROCHAINE fois, utilisez la commande <code class="language-plaintext highlighter-rouge">next</code> pour sauter la ligne où <code class="language-plaintext highlighter-rouge">printf</code> est affichée.</p>

<h2 id="note--cgdb-vs-gdb">Note : cgdb vs. gdb</h2>

<p>Dans cet exercice, nous utilisons <code class="language-plaintext highlighter-rouge">cgdb</code> pour déboguer nos programmes. <code class="language-plaintext highlighter-rouge">cgdb</code> est identique à <code class="language-plaintext highlighter-rouge">gdb</code>, sauf qu’il fournit des fonctionnalités supplémentaires qui le rendent plus agréable à utiliser en pratique. Toutes les commandes du « document de référence GDB » fonctionnent avec <code class="language-plaintext highlighter-rouge">gdb</code>.</p>

<p>Dans <code class="language-plaintext highlighter-rouge">cgdb</code>, vous pouvez appuyer sur la touche d’échappement pour aller à la fenêtre de code (en haut) et <code class="language-plaintext highlighter-rouge">i</code> pour revenir à la fenêtre de commande (en bas) - similaire à vim. La fenêtre de commande est l’endroit où vous entrerez vos commandes <code class="language-plaintext highlighter-rouge">gdb</code>.</p>

<h2 id="tâches-à-réaliser--1">Tâches à réaliser :</h2>

<p>Connaître les réponses aux questions ci-dessous vous sera très utile pour le reste de ce TP et pour votre carrière en informatique en général :</p>

<ol>
  <li>Lorsque vous êtes dans une session <code class="language-plaintext highlighter-rouge">cgdb</code>/<code class="language-plaintext highlighter-rouge">gdb</code>, comment <strong>définissez-vous les arguments</strong> qui seront transmis au programme lors de son exécution ?</li>
  <li>Comment faire pour créer un point d’arrêt dans un programme ?</li>
  <li>Comment exécuter <strong>la ligne suivante de code C</strong> après s’être arrêté à un point d’arrêt ?</li>
  <li>Si la ligne de code suivante est un appel de fonction alors vous exécuterez la fonction complète en un seul coup si vous utilisez votre réponse à la question n° 3 (Sinon, envisagez une commande différente pour la question n° 3!). Comment indiquer à GDB que vous <strong>voulez déboguer le code à l’intérieur de la fonction</strong> (c’est-à-dire entrer dans la fonction) ? (Si vous avez changé votre réponse à la question n° 3 alors la réponse précédente est probablement applicable ici.)</li>
  <li>Comment <strong>continuer l’exécution du programme après sa suspension</strong> à un point d’arrêt ?</li>
  <li>Comment <strong>imprimer la valeur d’une variable</strong> (ou même une expression comme 1 + 2) dans <code class="language-plaintext highlighter-rouge">gdb</code> ?</li>
  <li>Comment configurer <code class="language-plaintext highlighter-rouge">gdb</code> pour qu’il <strong>affiche la valeur d’une variable après chaque pas d’exécution</strong> ?</li>
  <li>Comment afficher <strong>une liste de toutes les variables et leurs valeurs</strong> dans la fonction en cours d’exécution ?</li>
  <li>Comment <strong>quitter</strong> gdb ?</li>
</ol>

<h1 id="exercise-3--valgrind">Exercise 3 : (Valgrind)</h1>

<p>Même avec un débogueur, nous ne pourrons peut-être pas détecter tous les bogues. Certains bogues sont ce que nous appelons des « bohrbugs », ce qui signifie qu’ils se manifestent de manière fiable dans un ensemble de conditions bien définies, mais peut-être inconnues. D’autres bogues sont ce que nous appelons des « heisenbugs », et au lieu d’être déterminants, ils sont connus pour disparaître ou modifier leur comportement lorsque l’on tente de les étudier. Nous pouvons détecter le premier type avec des débogueurs, mais le second type peut passer sous notre radar car ils sont (au moins en langage C) souvent dus à une mémoire mal gérée.</p>

<p>Rappelons que contrairement à d’autres langages de programmation, le C s’attend à ce que vous (le programmeur) gériez correctement la mémoire. Pour détecter et attraper ces « heisenbugs », nous utiliserons un outil appelé Valgrind. Cet outil est un programme qui émule votre processeur et répertorie tous vos accès mémoire. Cela ralentit considérablement le processus que vous exécutez (c’est pourquoi, par exemple, nous n’exécutons pas toujours tous les exécutables à l’intérieur de Valgrind), mais permet d’exposer des bogues qui peuvent autrement passer inaperçus.</p>

<p><strong>Remarque</strong> : Valgrind est déjà installé sur les machines des laboratoires et la VM. Cet outil est également disponible sur la plupart des distributions UN*X ainsi que sur macOS. Nous vous recommandons, toutefois, d’utiliser les machines des laboratoires ou la VM fournie pour ce cours pour éviter d’éventuelles problèmes de compatibilité. Les outils <code class="language-plaintext highlighter-rouge">gdb</code> et <code class="language-plaintext highlighter-rouge">Valgrind</code> deviendront incroyablement utiles pour vous au fur et à mesure que vous avancerez dans votre carrière d’informaticien.</p>

<p>Dans cet exercice, nous allons démontrer deux exemples d’utilisation de Valgrind et expliquer comment ils peuvents être utile.</p>

<p>À l’aide du compilateur <code class="language-plaintext highlighter-rouge">gcc</code>, construisez deux exécutables : <code class="language-plaintext highlighter-rouge">segfault_ex</code> à partir de <code class="language-plaintext highlighter-rouge">segfault_ex.c</code> et <code class="language-plaintext highlighter-rouge">no_segfault_ex</code> à partir de <code class="language-plaintext highlighter-rouge">no_segfault_ex.c</code> (utilisez le drapeau <code class="language-plaintext highlighter-rouge">-o</code> pour les noms d’exécutable !). Ensuite, essayez d’exécuter les programmes compilés… qu’observez-vous ?</p>

<p>Commençons par <code class="language-plaintext highlighter-rouge">segfault_ex</code>. Vous devriez avoir observé une erreur de segmentation (segfault), qui se produit lorsqu’un programme se bloque après avoir tenté d’accéder à de la mémoire qui ne lui est pas disponible (nous en parlerons plus tard dans le cours). Le code source <code class="language-plaintext highlighter-rouge">segfault_ex.c</code> est assez simple, vous devriez pouvoir « comprendre » facilement ce qui cause l’erreur de segmentation. Ne modifiez pas le fichier, il n’est pas nécessaire de corriger l’erreur ici.</p>

<p>Trouver une erreur de segmentation dans un fichier très volumineux ne sera pas une tâche facile, et c’est là où Valgrind peut intervenir. Pour exécuter le programme <code class="language-plaintext highlighter-rouge">segfault_ex</code> dans Valgrind, utilisez la commande :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>valgrind ./segfault_ex
</code></pre></div></div>

<p>Cela devrait amener Valgrind à afficher l’endroit où l’accès illégal s’est produit. Comparez ces résultats à ce que vous avez déterminé en examinons manuellement le fichier <code class="language-plaintext highlighter-rouge">segfault_ex.c</code>. Comment Valgrind pourrait-il vous aider à faire face à un segfault à l’avenir ?</p>

<p>Maintenant, essayez d’exécuter Valgrind sur <code class="language-plaintext highlighter-rouge">no_segfault_ex</code>. Le programme ne devrait pas planter mais il y a toujours un problème avec le fichier. Valgrind peut nous aider à trouver le problème (apparemment invisible).</p>

<p>Malheureusement, vous verrez ici que Valgrind semble ne pas être en mesure de vous dire exactement où le problème se produit. Utilisez le message fourni par Valgrind <strong>pour déterminer quelle variable a un comportement non défini, puis essayez de déduire ce qui a dû se passer</strong> (Indication : qu’est-ce qu’une valeur non initialisée ?).</p>

<p>À ce stade, nous ne nous attendons pas à ce que vous soyez familier avec l’utilisation du mot-clé <code class="language-plaintext highlighter-rouge">sizeof</code> dans un programme en langage C. Mais, vous pouvez, néanmoins, construire une certaine intuition autour de l’endroit où le problème s’est probablement produit.</p>

<h2 id="tâches-à-réaliser--2">Tâches à réaliser :</h2>

<p>Après avoir parcouru cet exercice, vous devriez être en mesure de comprendre et de répondre à ce qui suit :</p>
<ul>
  <li>Pourquoi Valgrind est un outil important et très utile ?</li>
  <li>Comment exécuter un programme dans Valgrind ?</li>
  <li>Comment interpréter les messages d’erreur ?</li>
  <li>Pourquoi des variables non initialisées peuvent-elles entraîner des « heisenbugs » ?</li>
</ul>

<!--  
Nous vous présentons Valgrind maintenant car c'est un outil extrêmement important dont vous aurez besoin quand vous écrivez des programmes en langage C. **Cependant, pour vraiment l'apprécier, nous devons apprendre davantage sur le modèle de mémoire dans le langage C, ce que nous ferons très prochainement**. Après avoir couvert la mémoire en cours, revenez à ce TP et essayez de répondre aux questions suivantes :

  - Pourquoi le programme `no_segfault_ex` n'a pas fait d'erreur de segmentation ?
  - Pourquoi le programme « `no_segfault_ex` » produit des résultats incohérents ?
  - Pourquoi l'utilisation actuelle de « `sizeof` » est incorrecte ? Comment pouvez-vous corriger cela ?
-->


  </article>

</div>
      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <!--     <h2 class="footer-heading"></h2> -->
    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">

        <p class="text">
          02 rue Didouche Mourad <br />
16000 Alger<br />

      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">


          

          

          

          

          




        </ul>
      </div>
    </div>

  </div>

</footer>

  </body>

</html>

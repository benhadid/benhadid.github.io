<!DOCTYPE html>
<html>

  <head>
  

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title> Traveaux Pratiques #2 - Stockage et accès aux données en mémoire - Architecture des ordinateurs / Automne 2020 </title>
  <meta name="description" content="Objectifs  Apprendre à effectuer des manipulations de bits spécifiques grâce à des compositions d’opérations sur les bits.  Apprendre à identifier les problè...">
  
  <link rel="stylesheet" href="/l2ado/_css/main.css">
  <link rel="canonical" href="http://benhadid.github.io//l2ado/labs/02_lab">
  <link rel="alternate" type="application/rss+xml" title="Architecture des ordinateurs / Automne 2020 - " href="http://benhadid.github.io//l2ado/feed.xml" />
<link rel='stylesheet' id='open-sans-css'  href='//fonts.googleapis.com/css?family=Open+Sans%3A300italic%2C400italic%2C600italic%2C300%2C400%2C600&#038;subset=latin%2Clatin-ext&#038;ver=4.2.4' type='text/css' media='all' />
<link href='https://fonts.googleapis.com/css?family=Titillium+Web:600italic,600,400,400italic' rel='stylesheet' type='text/css'>




<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">

<!-- MathJax -->
<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
</head>


  <body>

    <header class="site-header">

  <div class="wrapper" style="z-index: 100;">
      <table><tr>
          <td><img width="75" src="/l2ado/_images/logo.png" valign="middle"></td>
          <td style="padding-left:10px;"><a class="schoolname" style="font-size: 15px;" class="site-title" href=""></a>
          <br/>
          <span style="margin-top: -2px;margin-bottom: -10px;" class="site-title"><a href="/l2ado/" title="Architecture des ordinateurs / Automne 2020 - "><b>Architecture des ordinateurs</a></b></span>
          <br/>
          <span class="coursesemeter" style="font-size: 12px;font-weight: bold;margin-top: 10px;display: block;">Automne 2020</span>
          </td>
        </tr></table>

    <nav class="site-nav">

      <a href="#" class="menu-icon menu.open">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>  

    <div class="trigger"><h1>Main Navigation</h1>

 <ul class="menu">
    
    <li>
        <a class="page-link" href="/l2ado/">
            <i class="fa fa-home fa-lg"></i> Accueil
        </a>
    </li>
    
    <li>
        <a class="page-link" href="/l2ado/schedule/">
            <i class="fas fa-calendar-alt"></i> Programme
        </a>
    </li>
    
    <li>
        <a class="page-link" href="/l2ado/lectures/">
            <i class="fas fa-book-reader"></i> Cours
        </a>
    </li>
    
    <li>
        <a class="page-link" href="/l2ado/labs/">
            <i class="fas fa-laptop-code"></i> Pratiques
        </a>
    </li>
    
    <li>
        <a class="page-link" href="/l2ado/assignments/">
            <i class="fas fa-user-graduate"></i> Devoirs
        </a>
    </li>
    
    <li>
        <a class="page-link" href="/l2ado/project/">
            <i class="fas fa-user-graduate"></i> Projet
        </a>
    </li>
    
    <li>
        <a class="page-link" href="/l2ado/materials/">
            <i class="fas fa-book"></i> Support
        </a>
    </li>
    
</ul>

     </div>  
    </nav>

  </div>

  <div class="header-texture" style="height:100%; z-index: 0; position: absolute; top:0; right: 0; left: 0; 
  background-image: url('/l2ado/_images/pattern.png');" />

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Traveaux Pratiques #2 - Stockage et accès aux données en mémoire</h1>
    <p class="post-meta">Publié le Thursday 19/09/2019</p>
  </header>

  <div>
    
    <span style="font-weight: bold">Date prévue : 
      <!-- 26/09/2019 -->

      
      Jeudi
      26
      
      Septembre
      2019
  

    </span>
    

    
    <p style="font-weight: bold">Télécharger

      

      
      [<a href="/l2ado/static_files/labs/lab_02.zip">démarrage</a>]
      

      

    </p>
    

  </div>

  <br />
  <article class="post-content">
    <h1 id="objectifs">Objectifs</h1>
<ul>
  <li>Apprendre à effectuer des manipulations de bits spécifiques grâce à des compositions d’opérations sur les bits.</li>
  <li>Apprendre à identifier les problèmes potentiels en relation avec la gestion dynamique de la mémoire.</li>
</ul>

<h1 id="exercice-1">Exercice 1</h1>

<p>La compilation manuelle de programmes C dans le terminal (voir les exemples du TP précédent) est une opération fastidieuse et longue qui nécessite l’exécution de plusieurs commandes avec de longues séries d’arguments. Bien que cela soit faisable pour les programmes C simples, pour les programmes avec des dizaines de fichiers et de dépendances, cela devient rapidement assez compliqué.</p>

<p>Ainsi, la plupart des programmeurs C écrivent ce que l’on appelle un « makefile » pour faciliter la compilation. Un makefile est un fichier texte (littéralement appelé « Makefile ») qui se trouve dans le répertoire de code source et qui contient un ensemble de règles. Chacune de ces règles spécifie des commandes à exécuter pour manipuler un programme (ex : compiler un fichier source, effacer l’executable, etc). Une fois le fichier Makefile préparé, le programmeur a juste besoin de taper “make” dans son terminal de commande pour effectuer les tâches indiquées dans le makefile.</p>

<p>Jetez un oeil au « Makefile » inclus dans ce TP et essayez de répondre aux questions suivantes (Google est votre ami pour apprendre plus sur les Makefiles et répondre à certaines de ces questions).</p>

<ol>
  <li>Quelle cible (<em>anglais</em> : target) fait partie d’une règle qui supprime tous les programmes compilés ?</li>
  <li>Quelle cible fait partie d’une règle qui permet de compiler tous les programmes ?</li>
  <li>Quel compilateur est actuellement utilisé dans notre Makefile ?</li>
  <li>Quelle norme C utilisons-nous actuellement ?</li>
  <li>Comment est référencé une variable « FOO » dans un makefile ?</li>
  <li>Quel système d’exploitation le terme « Darwin » représente-t-il ?</li>
  <li>Quelle ligne crée le programme <code class="language-plaintext highlighter-rouge">lfsr</code> à partir de ses fichiers objets ?</li>
</ol>

<p>Makefiles a l’air intimidant, mais est en fait un outil incroyable qui permet de gagner beaucoup de temps !</p>

<h1 id="exercice-2">Exercice 2</h1>

<p>Commencez d’abord par télécharger le fichier de démarrage (voir plus haut dans ce document) et décompressez son contenu dans le répertoire de votre choix. Implémentez ensuite dans le fichier <code class="language-plaintext highlighter-rouge">bit_ops.c</code> les fonctions de manipulation de bits<code class="language-plaintext highlighter-rouge"> get_bit()</code>, <code class="language-plaintext highlighter-rouge">set_bit()</code> et<code class="language-plaintext highlighter-rouge"> flip_bit()</code> (illustrées ci-dessous). Vous pouvez utiliser UNIQUEMENT des opérations de manipulation de bits comme le <strong>et</strong> (<code class="language-plaintext highlighter-rouge">&amp;</code>), le <strong>ou</strong> (<code class="language-plaintext highlighter-rouge">|</code>), le <strong>xor</strong> (<code class="language-plaintext highlighter-rouge">^</code>), le <strong>not</strong> (<code class="language-plaintext highlighter-rouge">~</code>), le <strong>décalage à gauche</strong> (<code class="language-plaintext highlighter-rouge">&lt;&lt;</code>) et le <strong>décalage à droite</strong> (<code class="language-plaintext highlighter-rouge"> &gt;&gt; </code>). Vous ne pouvez pas utiliser de boucles for/while ou des instructions conditionnelles. Vous ne pouvez pas non plus utiliser les opérations arithmétiques ( modulo (%), division, soustraction, addition ou multiplication ) pour cet exercice.</p>

<pre><code class="language-C">// Retourne le n-ième bit de x.
// Vous pouvez considérer que 0 &lt;= n &lt;= 31
unsigned get_bit(unsigned x, unsigned n);

// Fixe le n-ième bit de la valeur de x à v.
// Vous pouvez considérer que 0 &lt;= n &lt;= 31, et v est soit 0 ou 1
void set_bit(unsigned *x, unsigned n, unsigned v);

// Inverse le n-ième bit de la valeur de x.
// Vous pouvez considérer que 0 &lt;= n &lt;= 31
void flip_bit(unsigned *x, unsigned n);

</code></pre>

<h2 id="tâches-à-réaliser-">Tâches à réaliser :</h2>

<p>Une fois l’implémentation des fonctions <code class="language-plaintext highlighter-rouge">get_bit()</code>, <code class="language-plaintext highlighter-rouge">set_bit()</code> et <code class="language-plaintext highlighter-rouge">flip_bit()</code> est achevée, vous pouvez compiler et exécuter votre code à l’aide des commandes suivantes :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>make bit_ops
<span class="nv">$ </span>./bit_ops
</code></pre></div></div>

<p>Cela imprimera le résultat de quelques tests limités.</p>

<h1 id="exercice-3">Exercice 3</h1>

<p>Dans cet exercice, vous implémenterez une fonction <code class="language-plaintext highlighter-rouge">lfsr_calculate()</code> pour calculer la prochaine itération d’un registre à décalage à rétroaction linéaire (LFSR). Les applications qui utilisent les LFSR sont: la télévision numérique, les téléphones portables CDMA, Ethernet, USB 3.0 et bien plus encore ! Cette fonction générera des nombres pseudo-aléatoires en utilisant des opérateurs de bits. Pour plus d’informations, consultez l’article de Wikipedia sur <a href="https://fr.wikipedia.org/wiki/Registre_%C3%A0_d%C3%A9calage_%C3%A0_r%C3%A9troaction_lin%C3%A9aire">les registres à décalage à rétroaction linéaire</a>. Dans <code class="language-plaintext highlighter-rouge">lfsr.c</code>, implementez la fonction<code class="language-plaintext highlighter-rouge"> lfsr_calculate()</code> pour qu’elle réalise l’opération illustrée ci-dessous :</p>

<p><img src="/l2ado/static_files/images/lfsr.gif" alt="LFSR" class="center-image" height="50%" width="50%" /></p>

<h2 id="expliquations-">Expliquations :</h2>

<ul>
  <li>A chaque appel à <code class="language-plaintext highlighter-rouge">lfsr_calculate</code>, vous déplacerez le contenu du registre d’un bit vers la droite.</li>
  <li>Ce décalage n’est ni un décalage logique ni un décalage arithmétique. Sur le côté gauche, vous injecterez un bit qui est égal au OU exclusif (XOR) des bits originaires des positions 0, 2, 3 et 5.</li>
  <li>Le symbole rouge illustrant un signe <code class="language-plaintext highlighter-rouge">plus dans un cercle</code> représente un <code class="language-plaintext highlighter-rouge">OU exclusif</code>, qui prend deux entrées (a, b) et produit a^b.</li>
  <li>Si vous avez implémenté correctement <code class="language-plaintext highlighter-rouge">lfsr_calculate()</code>, la fonction devrait afficher tous les 65535 entiers positifs sur 16 bits avant de revenir au numéro de départ.</li>
  <li>Notez que le bit le plus à gauche est le MSB et le bit le plus à droite est le LSB.</li>
</ul>

<h2 id="tâches-à-réaliser--1">Tâches à réaliser :</h2>

<p>Implémentez la fonction <code class="language-plaintext highlighter-rouge">lfsr_calculate()</code> dans le fichier <code class="language-plaintext highlighter-rouge">lfsr.c</code> puis compilez et exécutez ce dernier à l’aide de la commande <code class="language-plaintext highlighter-rouge">make</code> (voir ci-dessous). Vérifiez que le résultat affiché ressemble à ce qui suit :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>make lfsr
<span class="nv">$ </span>./lfsr
My number is: 1
My number is: 5185
My number is: 38801
My number is: 52819
My number is: 21116
My number is: 54726
My number is: 26552
My number is: 46916
My number is: 41728
My number is: 26004
My number is: 62850
My number is: 40625
My number is: 647
My number is: 12837
My number is: 7043
My number is: 26003
My number is: 35845
My number is: 61398
My number is: 42863
My number is: 57133
My number is: 59156
My number is: 13312
My number is: 16285
 ... etc etc ...
Got 65535 numbers before cycling!
Congratulations! It works!
</code></pre></div></div>

<h1 id="exercise-4">Exercise 4</h1>

<p>Cet exercice utilise les fichiers <code class="language-plaintext highlighter-rouge">vector.h</code>, <code class="language-plaintext highlighter-rouge">vector-test.c</code> et <code class="language-plaintext highlighter-rouge">vector.c</code> pour implémenter des fonctionnalités pour la gestion des tableaux C de longueur variable. Cet exercice est conçu pour vous aider à vous familiariser avec les structures C et la gestion de la mémoire en langage C.</p>

<h2 id="tâches-à-réaliser--2">Tâches à réaliser :</h2>

<p>Expliquez pourquoi <code class="language-plaintext highlighter-rouge">bad_vector_new()</code> et <code class="language-plaintext highlighter-rouge">also_bad_vector_new()</code> sont de mauvaises implémentations et remplissez les fonctions <code class="language-plaintext highlighter-rouge">vector_new()</code>, <code class="language-plaintext highlighter-rouge">vector_get()</code>, <code class="language-plaintext highlighter-rouge">vector_delete()</code> et <code class="language-plaintext highlighter-rouge">vector_set()</code> dans <code class="language-plaintext highlighter-rouge">vector.c</code>. Insérez également les prototypes de ces fonctions dans le fichier entête <code class="language-plaintext highlighter-rouge">vector.h</code> afin que le code de test <code class="language-plaintext highlighter-rouge">vector-test.c</code> puisse s’exécuter sans aucune erreur.</p>

<p>Additionnellement, implémentez une règle pour la cible <code class="language-plaintext highlighter-rouge">vector-test</code> dans le makefile.</p>

<p>Les commentaires dans le code décrivent comment les fonctions doivent fonctionner. Consultez les fonctions déjà implémentées pour voir comment les structures de données doivent être utilisées. Par souci de cohérence, il est supposé que toutes les entrées du vecteur sont égales à <code class="language-plaintext highlighter-rouge">0</code> à moins qu’elles ne soient explicitement définies/modifiées par l’utilisateur. Rappelez-vous de cela parce que la fonction <code class="language-plaintext highlighter-rouge">malloc()</code> ne met pas à zéro la mémoire qu’elle alloue.</p>

<p>Pour expliquer pourquoi les deux mauvaises fonctions sont incorrectes, gardez à l’esprit que l’une de ces fonctions s’exécutera correctement mais il peut y avoir d’autres problèmes (invisibles). Indication : Examinez l’utilisation de la mémoire.</p>

<p>Vérifiez votre implémentation de <code class="language-plaintext highlighter-rouge">vector_new()</code>, <code class="language-plaintext highlighter-rouge">vector_get()</code>, <code class="language-plaintext highlighter-rouge">vector_delete()</code> et <code class="language-plaintext highlighter-rouge">vector_set()</code> par rapport à l’exactitude des résultats et aussi par rapport à la gestion corrècte de la mémoire (détails ci-dessous).</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 1) pour vérifier l'exactitude des résultats</span>
<span class="nv">$ </span>make vector-test
<span class="nv">$ </span>./vector-test

<span class="c"># 2) pour vérifier la gestion de la mémoire avec Valgrind</span>
<span class="nv">$ </span>make vector-memcheck
</code></pre></div></div>

<p>Tout ce que la [règle] (https://www.gnu.org/software/make/manual/make.html#Rule-Introduction) <code class="language-plaintext highlighter-rouge">vector-memcheck</code> fait est d’exécuter la commande valgrind suivante sur notre exécutable. Pour rappel sur Valgrind, revoir l’exercice 3 du TP <a href="/l2ado/labs/01_lab">précédent</a>. Que signifie chacun des drapeaux/paramètres dans la commande suivante ?</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>valgrind <span class="nt">--tool</span><span class="o">=</span>memcheck <span class="nt">--leak-check</span><span class="o">=</span>full <span class="nt">--track-origins</span><span class="o">=</span><span class="nb">yes</span> <span class="o">[</span>OS SPECIFIC ARGS] ./&lt;executable&gt;
</code></pre></div></div>

<p>La dernière ligne de la sortie valgrind vous indiquera en un coup d’oeil s’il y a eu des erreurs. Voici un exemple de sortie d’un programme bogué :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">==</span><span class="nv">47132</span><span class="o">==</span> ERROR SUMMARY: 1200039 errors from 24 contexts <span class="o">(</span>suppressed: 18 from 18<span class="o">)</span>
</code></pre></div></div>

<p>Si votre programme comporte des erreurs, vous pouvez faire défiler la sortie de la ligne de commande pour afficher les détails de chacune des erreurs. Pour cet exercice, vous pouvez ignorer toutes les sorties faisant référence à des erreurs supprimées (<em>anglais</em> : suppressed). Dans un programme sans problèmes de mémoire, votre sortie ressemblera à ceci :</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">==</span><span class="nv">44144</span><span class="o">==</span> ERROR SUMMARY: 0 errors from 0 contexts <span class="o">(</span>suppressed: 18 from 18<span class="o">)</span>
</code></pre></div></div>

<p>Au final, n’hésitez pas à utiliser également CGDB ou à ajouter des instructions <code class="language-plaintext highlighter-rouge">printf</code> à <code class="language-plaintext highlighter-rouge">vector.c</code> et <code class="language-plaintext highlighter-rouge">vector-test.c</code> pour déboguer votre code.</p>

  </article>

</div>
      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <!--     <h2 class="footer-heading"></h2> -->
    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">

        <p class="text">
          02 rue Didouche Mourad <br />
16000 Alger<br />

      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">


          

          

          

          

          




        </ul>
      </div>
    </div>

  </div>

</footer>

  </body>

</html>
